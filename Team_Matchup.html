<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen py-8">

<a href="./index.html" class="fixed top-4 left-4 inline-flex items-center gap-2 px-3 py-2 rounded-full border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 shadow hover:shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition">
  <span class="text-xs font-bold tracking-wide">HOME</span>
  <i class="fa fa-house"></i>
</a>

<div class="max-w-5xl mx-auto px-4">
  <div id="games" class="grid gap-4 md:gap-6"></div>
</div>

<script>
  function fmtLocalTime(iso){
    try{
      const d = new Date(iso);
      const dateStr = d.toLocaleDateString(undefined, { weekday:'short', month:'short', day:'2-digit', year:'numeric' });
      const timeStr = d.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit' });
      return { date: dateStr, time: timeStr };
    }catch(e){ return { date:'', time:'' }; }
  }

  function badge(price){
    if (price == null || isNaN(Number(price))) return '';
    const p = Number(price);
    return `<span class="text-lg text-gray-600 dark:text-gray-400">(${p>=0? '+'+p : p})</span>`;
  }

  function spreadBox(teamLabel, spread){
    if (!spread || spread.point == null) return '';
    const point = Number(spread.point);
    const isFav = point < 0;
    const color = isFav ? 'text-red-600' : 'text-green-600';
    const sign = point>0? '+'+point : String(point);
    return `
      <div class="bet-option">
        <div class="text-sm font-medium mb-1">${teamLabel}</div>
        <div class="flex items-center justify-between mb-2">
          <span class="text-2xl font-bold ${color}">${sign}</span>
          ${badge(spread.price)}
        </div>
      </div>`;
  }

  function moneylineBox(teamLabel, price){
    if (price == null) return '';
    const p = Number(price);
    const color = p >= 0 ? 'text-green-600' : 'text-red-600';
    const shown = p>=0? '+'+p : p;
    return `
      <div class="bet-option">
        <div class="text-sm font-medium mb-1">${teamLabel}</div>
        <div class="text-2xl font-bold ${color}">${shown}</div>
      </div>`;
  }

  function logoTag(src, alt){
    return src ? `<img src="${src}" alt="${alt}" class="w-12 h-12 rounded-full">` : '';
  }

  function renderEvent(ev){
    const { date, time } = fmtLocalTime(ev.commence_time);
    const homeLogo = ev.logos && ev.logos.home ? ev.logos.home : '';
    const awayLogo = ev.logos && ev.logos.away ? ev.logos.away : '';
    const homeSpread = ev.best_spread && ev.best_spread.home ? ev.best_spread.home : null;
    const awaySpread = ev.best_spread && ev.best_spread.away ? ev.best_spread.away : null;
    const homeML = ev.best_h2h ? ev.best_h2h.home : null;
    const awayML = ev.best_h2h ? ev.best_h2h.away : null;

    const card = document.createElement('div');
    card.className = 'game-card bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700';
    card.innerHTML = `
      <div class="game-header bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4">
        <div class="flex justify-between items-start mb-3">
          <div class="game-time">
            <div class="text-sm opacity-90">${date}</div>
            <div class="text-lg font-bold">${time}</div>
          </div>
          <div class="text-right">
            <div class="text-xs opacity-90">Bookmakers</div>
            <div class="text-2xl font-extrabold">${ev.bookmakers_count || 0}</div>
          </div>
        </div>
        <div class="teams-display flex items-center justify-between -mx-4 px-4 py-5">
          <div class="team-info flex items-center gap-3">
            ${logoTag(homeLogo, ev.home_team)}
            <div>
              <div class="font-bold text-lg">${ev.home_team}</div>
            </div>
          </div>
          <div class="text-xl font-bold px-4">VS</div>
          <div class="team-info flex items-center gap-3 text-right">
            <div>
              <div class="font-bold text-lg">${ev.away_team}</div>
            </div>
            ${logoTag(awayLogo, ev.away_team)}
          </div>
        </div>
      </div>

      <div class="betting-grid grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 dark:bg-gray-900">
        <div class="bet-card bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
          <h3 class="text-sm font-bold text-gray-600 dark:text-gray-400 mb-3">Point Spread</h3>
          <div class="space-y-4">
            ${spreadBox(ev.home_team, homeSpread)}
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">${spreadBox(ev.away_team, awaySpread)}</div>
          </div>
        </div>

        <div class="bet-card bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
          <h3 class="text-sm font-bold text-gray-600 dark:text-gray-400 mb-3">Moneyline</h3>
          <div class="space-y-4">
            ${moneylineBox(ev.home_team, homeML)}
            <div class="pt-4 border-t border-gray-200 dark:border-gray-700">${moneylineBox(ev.away_team, awayML)}</div>
          </div>
        </div>

        <div class="bet-card bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
          <h3 class="text-sm font-bold text-gray-600 dark:text-gray-400 mb-3">Meta</h3>
          <div class="text-xs text-gray-500 space-y-1">
            <div>ID: ${ev.id}</div>
            <div>Source: the-odds-api</div>
          </div>
        </div>
      </div>
    `;
    return card;
  }

  (function(){
    function tryFetch(paths){
      const [p, ...rest] = paths;
      return fetch(p).then(r => {
        if (r.ok) return r.json();
        if (rest.length) return tryFetch(rest);
        return Promise.reject(new Error('Failed to load odds'));
      }).catch(err => {
        if (rest.length) return tryFetch(rest);
        throw err;
      });
    }

    const base = (document.querySelector('base') && document.querySelector('base').href) || '';
    const origin = location.origin;
    const repoBase = `${origin}/NBA-UI-Props/`;
    const candidates = [
      './data/odds/latest.json',
      'data/odds/latest.json',
      '../data/odds/latest.json',
      `${repoBase}data/odds/latest.json`,
      'https://raw.githubusercontent.com/cgpropz/NBA-UI-Props/main/data/odds/latest.json'
    ];

    tryFetch(candidates)
      .then(data => {
        const events = Array.isArray(data.events) ? data.events : [];
        const container = document.getElementById('games');
        container.innerHTML = '';
        if (!events.length) {
          container.innerHTML = '<div class="text-center text-sm text-gray-500 dark:text-gray-400">No games found for today.</div>';
          return;
        }
        // sort by commence_time
        events.sort((a,b) => new Date(a.commence_time) - new Date(b.commence_time));
        events.forEach(ev => container.appendChild(renderEvent(ev)));
      })
      .catch(err => {
        const container = document.getElementById('games');
        console.error('[CGEDGE] Odds load error:', err);
        container.innerHTML = `<div class="text-center text-sm text-red-500">Error loading matchups: ${err && err.message ? err.message : 'Unknown error'}</div>`;
      });
  })();
</script>

</body>
</html>