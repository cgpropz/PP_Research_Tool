<!DOCTYPE html>
<html>
<head>
    <title>Debug Odds Loading</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        pre { background: #111; padding: 10px; border: 1px solid #0f0; margin: 10px 0; max-height: 600px; overflow-y: auto; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>Odds Loading Diagnostic</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        async function fetchJson(path) {
            try {
                const res = await fetch(path);
                if (!res.ok) throw new Error(`Status ${res.status}`);
                return await res.json();
            } catch (err) {
                throw err;
            }
        }
        
        async function debug() {
            let html = '';
            
            try {
                html += '<h2>Step 1: Fetching Cards</h2>';
                const ppCards = await fetchJson('PLAYER_UI_CARDS_PERFECT.json');
                html += `<pre class="success">✓ Loaded ${ppCards.length} cards</pre>`;
                html += `<pre>Sample card:\n${JSON.stringify(ppCards[0], null, 2)}</pre>`;
                
                html += '<h2>Step 2: Fetching Odds</h2>';
                const oddsData = await fetchJson('nba_player_odds.json');
                html += `<pre class="success">✓ Loaded odds for ${oddsData.length} players</pre>`;
                html += `<pre>Sample odds:\n${JSON.stringify(oddsData[0], null, 2)}</pre>`;
                
                html += '<h2>Step 3: Building Rows</h2>';
                const oddsMap = {};
                oddsData.forEach(o => { oddsMap[o.name] = o; });
                
                const oddsPropMap = {
                    'Points': 'points', 'Rebounds': 'rebounds', 'Assists': 'assists',
                    'Steals': 'steals', 'Blocked Shots': 'blocks', 'Turnovers': 'turnovers',
                    'Fantasy Score': 'fantasyPts', '3PM': 'fg3PtMade',
                    'Pts+Rebs+Asts': 'pointsReboundsAssists', 'Pts+Rebs': 'pointsRebounds',
                    'Pts+Asts': 'pointsAssists', 'Rebs+Asts': 'reboundsAssists',
                    'FG Att': 'fgAtt', '3PT Att': 'fg3PtAtt', '2PT Att': 'twoPtAtt',
                    'Defensive Rebounds': 'defRebounds', 'Offensive Rebounds': 'offRebounds'
                };
                
                let rowCount = 0;
                let matchedCount = 0;
                let noPropCount = 0;
                let noBookCount = 0;
                
                for (let i = 0; i < Math.min(10, ppCards.length); i++) {
                    const card = ppCards[i];
                    const playerOdds = oddsMap[card.name];
                    
                    if (!playerOdds || !playerOdds.projection) {
                        html += `<div class="warning">⚠ ${card.name} - no odds</div>`;
                        continue;
                    }
                    matchedCount++;
                    
                    const oddsKey = oddsPropMap[card.prop];
                    if (!oddsKey || !playerOdds.projection[oddsKey]) {
                        html += `<div class="warning">⚠ ${card.name} - ${card.prop} - no ${oddsKey}</div>`;
                        noPropCount++;
                        continue;
                    }
                    
                    const propOdds = playerOdds.projection[oddsKey];
                    const books = propOdds.books || [];
                    
                    if (books.length === 0) {
                        html += `<div class="warning">⚠ ${card.name} - ${card.prop} - no books</div>`;
                        noBookCount++;
                        continue;
                    }
                    
                    rowCount += 2; // Over and Under
                    html += `<div class="success">✓ ${card.name} - ${card.prop} - ${books.length} books → 2 rows</div>`;
                }
                
                html += `<pre class="success">
Cards tested: 10
Matched to odds: ${matchedCount}
No prop odds: ${noPropCount}
No books: ${noBookCount}
Rows that would be created: ${rowCount}
                </pre>`;
                
            } catch (err) {
                html += `<pre class="error">ERROR: ${err.message}\n${err.stack}</pre>`;
            }
            
            output.innerHTML = html;
        }
        
        debug();
    </script>
</body>
</html>
