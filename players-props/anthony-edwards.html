<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NBA Player Detail</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style.css">
    <style>
        .player-detail-container { max-width: 600px; margin: 32px auto; background: #181f1b; border-radius: 18px; box-shadow: 0 0 32px 8px #8000ff65; padding: 32px 24px; }
        .player-detail-img { width: 180px; height: 180px; object-fit: contain; display: block; margin: 0 auto 12px auto; background: #222; border-radius: 50%; border: 4px solid #00ff7f; }
        .player-detail-badges { display: flex; justify-content: center; gap: 0.5em; margin-bottom: 1em; }
        .player-detail-badge { font-weight: bold; border-radius: 6px; padding: 0.1em 0.7em; font-size: 1em; display: inline-block; }
        .navbar-props { display: flex; justify-content: center; gap: 1em; margin: 18px 0 18px 0; }
        .navbar-props button { background: #222b22; color: #00ff7f; border: 2px solid #00ff7f; border-radius: 8px; padding: 6px 18px; font-weight: 700; cursor: pointer; transition: background 0.2s, color 0.2s; }
        .navbar-props button.active, .navbar-props button:hover { background: #00ff7f; color: #181f1b; }
        .gamelog-table { width: 100%; border-collapse: collapse; margin-top: 18px; }
        .gamelog-table th, .gamelog-table td { border: 1px solid #333; padding: 6px 8px; text-align: center; }
        .gamelog-table th { background: #222b22; color: #00ff7f; }
        .gamelog-table td { background: #181f1b; color: #fff; }
    </style>
</head>
<body>
    <div style="text-align:center;margin-top:24px;">
        <a href="../props-trend.html" style="text-decoration:none;">
            <button style="background:#00ff7f;color:#181f1b;border:none;border-radius:8px;padding:10px 28px;font-size:1.1em;font-weight:700;cursor:pointer;box-shadow:0 2px 8px #8000ff44;">üè† Home</button>
        </a>
    </div>
    <div class="player-detail-container">
    <img id="player-img" class="player-detail-img" src="" alt="Player Image">
    <div class="player-detail-badges" id="player-badges"></div>
    <h2 id="player-name" style="text-align:center;color:#fff;"></h2>
    <div class="navbar-props" id="prop-navbar"></div>
    <div id="gamelog-section"></div>
</div>
<script>
// Utility: get player slug from URL
function getPlayerSlug() {
    const parts = window.location.pathname.split('/');
    return parts[parts.length-1].replace('.html','');
}

async function fetchJson(path) {
    const res = await fetch(path);
    return res.json();
}

function getTeamColor(team) {
    const TEAM_COLORS = {
      ATL: {bg: '#E03A3E', text: '#fff'}, BOS: {bg: '#007A33', text: '#fff'}, BKN: {bg: '#000', text: '#fff'}, CHA: {bg: '#1D1160', text: '#fff'}, CHI: {bg: '#CE1141', text: '#fff'}, CLE: {bg: '#6F263D', text: '#fff'}, DAL: {bg: '#00538C', text: '#fff'}, DEN: {bg: '#0E2240', text: '#fff'}, DET: {bg: '#C8102E', text: '#fff'}, GSW: {bg: '#1D428A', text: '#FFC72C'}, HOU: {bg: '#CE1141', text: '#fff'}, IND: {bg: '#002D62', text: '#FDBB30'}, LAC: {bg: '#C8102E', text: '#fff'}, LAL: {bg: '#552583', text: '#FDB927'}, MEM: {bg: '#5D76A9', text: '#fff'}, MIA: {bg: '#98002E', text: '#fff'}, MIL: {bg: '#00471B', text: '#fff'}, MIN: {bg: '#0C2340', text: '#fff'}, NOP: {bg: '#0C2340', text: '#fff'}, NYK: {bg: '#006BB6', text: '#fff'}, OKC: {bg: '#007AC1', text: '#fff'}, ORL: {bg: '#0077C0', text: '#fff'}, PHI: {bg: '#006BB6', text: '#fff'}, PHX: {bg: '#1D1160', text: '#fff'}, POR: {bg: '#E03A3E', text: '#fff'}, SAC: {bg: '#5A2D81', text: '#fff'}, SAS: {bg: '#C4CED4', text: '#000'}, TOR: {bg: '#CE1141', text: '#fff'}, UTA: {bg: '#002B5C', text: '#fff'}, WAS: {bg: '#002B5C', text: '#fff'}
    };
    return TEAM_COLORS[team] || {bg:'#222', text:'#fff'};
}

async function renderPlayerPage() {
    const slug = getPlayerSlug();
    const playerData = await fetchJson('../PLAYER_UI_CARDS_PERFECT.json');
    const gamelogs = await fetchJson('../Player_Gamelogs25.json');
    // Find player by slug
    const player = playerData.find(p => p.name && p.name.toLowerCase().replace(/[^a-z0-9]+/g, '-') === slug);
    if (!player) {
        document.getElementById('player-name').textContent = 'Player not found';
        return;
    }
    // Use NBA CDN image for consistency with props-trend.html
    function getPlayerImage(playerId) {
        return playerId ? `https://cdn.nba.com/headshots/nba/latest/260x190/${playerId}.png` : '';
    }
    document.getElementById('player-img').src = getPlayerImage(player.playerId);
    document.getElementById('player-name').textContent = player.name;
    // Badges
    const badgesDiv = document.getElementById('player-badges');
    badgesDiv.innerHTML = '';
    // Team badge
    if (player.team) {
        const c = getTeamColor(player.team);
        badgesDiv.innerHTML += `<span class='player-detail-badge' style='background:${c.bg};color:${c.text};'>${player.team}</span>`;
    }
    // Opponent badge
    if (player.opponent) {
        const c = getTeamColor(player.opponent);
        badgesDiv.innerHTML += `<span class='player-detail-badge' style='background:${c.bg};color:${c.text};'>vs ${player.opponent}</span>`;
    }
    // Position badge
    if (player.position) {
        badgesDiv.innerHTML += `<span class='player-detail-badge' style='background:#222b22;color:#fff;'>${player.position}</span>`;
    }
    // Prop types navbar
    const propTypes = Array.from(new Set(playerData.filter(p => p.name === player.name).map(p => p.prop)));
    const navbar = document.getElementById('prop-navbar');
    navbar.innerHTML = '';
    propTypes.forEach((prop, idx) => {
        navbar.innerHTML += `<button class='${idx===0?'active':''}' onclick='showGamelogs("${prop}")'>${prop}</button>`;
    });
    // Show gamelogs for first prop by default
    showGamelogs(propTypes[0]);
    // Gamelog rendering function
    window.showGamelogs = function(propType) {
        Array.from(navbar.children).forEach(btn => btn.classList.remove('active'));
        Array.from(navbar.children).find(btn => btn.textContent === propType).classList.add('active');
        // Filter and sort last 10 games for this player (by GAME DATE descending)
        const logs = gamelogs
            .filter(g => g.PLAYER === player.name)
            .sort((a, b) => {
                // Parse date as YYYY-MM-DD for comparison
                const parse = d => d && d['GAME DATE'] ? d['GAME DATE'].split('/').reverse().join('-') : '';
                return parse(b) > parse(a) ? 1 : -1;
            })
            .slice(0, 10);
        let html = `<table class='gamelog-table'><tr><th>Date</th><th>Matchup</th><th>MIN</th><th>PTS</th><th>REB</th><th>AST</th><th>STL</th><th>BLK</th><th>FP</th></tr>`;
        logs.forEach(g => {
            html += `<tr><td>${g['GAME DATE'] || ''}</td><td>${g['MATCH UP'] || ''}</td><td>${g['MIN'] || ''}</td><td>${g['PTS'] || ''}</td><td>${g['REB'] || ''}</td><td>${g['AST'] || ''}</td><td>${g['STL'] || ''}</td><td>${g['BLK'] || ''}</td><td>${g['FP'] !== undefined ? g['FP'].toFixed(1) : ''}</td></tr>`;
        });
        html += `</table>`;
        document.getElementById('gamelog-section').innerHTML = html;
    }
}
renderPlayerPage();
</script>
</body>
</html>
